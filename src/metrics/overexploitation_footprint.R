library(readr)
library(dplyr)
library(ggplot2)
library(forcats)
library(openxlsx)

gfw_effort <- read_csv("output/data/gfw_apparent_fishing_effort/gfw_effort_MONTHLY_LOW_2020-2024.csv")

reconstructed_catch <- read_csv("output/data/sau_catch/sau_reconstructed_catch_clean.csv")
extrapolated_catch <- read_csv("output/data/sau_catch/extrapolation/automatic_v2_mae/extrapolation_results.csv")

status <- read.xlsx("")

extrapolated_catch |> 
  distinct(note)

reconstructed_catch |> 
  summarize(tonnes = sum(reconstructed_catch_tonnes, na.rm = TRUE),
            .by = functional_group) |> 
  ggplot(aes(x = fct_reorder(functional_group, tonnes), y = tonnes)) +
  geom_bar(stat = "identity") +
  coord_flip()

extrapolated_catch |> 
  rowwise() |> 
  mutate(tonnes = max(tonnes, 0)) |> 
  ungroup() |> 
  left_join(reconstructed_catch |> distinct(scientific_name, functional_group),
            by = "scientific_name",
            relationship = "many-to-one") |> 
  summarize(tonnes = sum(tonnes, na.rm = TRUE),
            .by = functional_group) |> 
  ggplot(aes(x = fct_reorder(functional_group, tonnes), y = tonnes)) +
  geom_bar(stat = "identity") +
  coord_flip()

# groups <- reconstructed_catch |> 
#   distinct(functional_group) |> 
#   mutate(
#     associated_gear_type = case_when(
#       grepl(functional_group, 
#   )
